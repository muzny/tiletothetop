function getAccountData(){messenger.getUserData()}
function insertAccountData(a){USER_DATA=a;if(a.hasOwnProperty("username")){$("#username").text(a.username);var b=a.date_joined.split(" ")[0];$("#date_joined").text(b);b=a.last_login.split(" ")[0];$("#last_login").text(b);$("#games_played").text(a.games_played);!a.hasOwnProperty("first_name")||""===a.first_name?($("#first_name").remove(),$("#first_name_label").remove()):$("#first_name").text(a.first_name);!a.hasOwnProperty("last_name")||""===a.last_name?($("#last_name").remove(),$("#last_name_label").remove()):
$("#last_name").text(a.last_name);!a.hasOwnProperty("email")||""===a.email?($("#email").remove(),$("#email_label").remove()):$("#email").text(a.email)}};var Board=function(a){score=0;var b=[],c=[];$.each(a.words,function(e){b[e]=a.words[e].definition;c[e]=a.words[e].word});this.mode=a.mode;var d=$("<div>").attr("id","definitions-answers-area");$("#game-area").append(d);this.definitions=new DefinitionArea(b);this.workspace=new Workspace(c);for(var d=[],g=0;g<c.length;g++)d=d.concat(c[g].split(""));this.tileArea=new TileArea(d);timer&&timer.pause();timer=new Timer(1E3)};var DefinitionArea=function(a){function b(a){for(var b=$("#answer_"+a).children(),c=0,d=0;d<b.length;d++)0==$(b[d]).text().length&&c++;if(0!=c){c=parseInt(Math.random()*c,10);for(d=0;d<b.length;d++)if(0==$(b[d]).text().length&&c--,-1==c){a=window.board.workspace.getSolutions()[a][d];$(b[d]).text(a.toUpperCase());numberHintsUsed++;score-=HINT_PENALTY;break}}}this.getDefinitions=function(){return a};var c=$("<div>").addClass("left-col"),d=function(){var a=$(this).attr("id"),a=parseInt(a.charAt(a.length-
1),10);b(a)};this.displayHint=function(a){return b(a)};$.each(a,function(b){var e=$("<div>");e.addClass("definition");e.addClass("jtextfill");e.attr("id","def_"+b);var f=$("<div>");f.addClass("hint-box");f.attr("id","hint_"+b);f.attr({type:"button",rel:"tooltip","data-title":"Reveals a random letter at the cost of "+HINT_PENALTY+" points.","data-placement":"left"});f.bind("click",d);f.append("Hint");f.disableSelection();e.append(f);f=$("<span>");f.text(a[b]);e.append(f);c.append(e)});$("#definitions-answers-area").append(c)};function handleDragMouseMove(a){a=a.target;1===window.event.button&&a.dragDrop()}function dragTile(a){a.dataTransfer.setData("Text",a.currentTarget.id)}function dragTileOverTileArea(a){a.preventDefault()}function leaveTileArea(){}
function dropTileInTileArea(a){a.preventDefault();if(0==$("#"+a.currentTarget.id).children().length){var b=a.dataTransfer.getData("Text"),b=document.getElementById(b);a.currentTarget.appendChild(b);$(b).centerOnParent();$(b).hasClass("inTileArea")||$(b).addClass("inTileArea")}}function dragTileOverEmptyTile(a){0==$("#"+a.target.id).children().length&&a.preventDefault()}function leaveEmptyTile(){}
function dropTileInEmptyTile(a){a.preventDefault();if(0==$("#"+a.currentTarget.id).children().length){var b=a.dataTransfer.getData("Text"),b=document.getElementById(b);a.currentTarget.appendChild(b);$(b).centerOnParent();$(b).removeClass("inTileArea");checkGameWon()}};var board=null,messenger=null,timer=null,score=0,numberHintsUsed=0,HINT_PENALTY=100,USER_DATA={},MAX_FONT=36,TILE_SIZE=60,TIMER_PENALTY=10,TIMER_CUTOFF=60,ANSWER_CHEAT_ON=-1!=window.location.host.indexOf("localhost")||-1!=window.location.host.indexOf("127.0.0.1"),MODAL_IDS=["#login-modal","#register-modal"],MAX_DIFFICULTY=150,INCR_DIFFICULTY=5,isPrevStepLess=!1,expDifficultyStep=INCR_DIFFICULTY,NUM_WORDS=4,MAX_WORDLEN=10,inStartMenu=!1,setupEvents=!1,gameIsStarted=!1;
$(window).load(function(){$.ajaxSetup({cache:!1});initializeMenuButtons();initializeWordListButtons();messenger=new Messenger;getAccountData();getUserRank();getLeaderboard(10);createStaticGameIfApplicable()});function initializeBoard(a){null!=board&&($("#definitions-answers-area").remove(),$("#tiles-area").remove());board=new Board(a);$(".jtextfill").textfill({maxFontPixels:MAX_FONT})}
function hideGameElements(){var a=$("#game-area").find(".definition"),b=$("#game-area").find(".emptyTileLoc"),c=$("#game-area").find(".tile"),a=$.merge(a,$.merge(b,c));$.each(a,function(){$(this).hide()})}
function showGameElements(){function a(b){if(0!==b.length){var c=b.splice(0,1),f=50;$(c).hasClass("definition")&&(f=400);$(c).show(f,function(){a(b)})}}var b=$("#game-area").find(".definition"),c=$("#game-area").find(".emptyTileLoc"),d=$("#game-area").find(".tile"),b=$.merge(b,$.merge(c,d));a(b.toArray())}
function checkGameWon(){if(window.board.workspace.winCheck()){for(var a=window.board.workspace.getSolutions(),b=0,c=0;c<a.length;c++)b+=scoreFunc(a[c]);a=Math.max(0,(TIMER_CUTOFF-(60*timer.getMin()+timer.getSec()))*TIMER_PENALTY);$("#score-base").text(b);$("#score-bonus").text(a);$("#score-penalty").text(score);$("#score-breakdown").show();score+=b;score+=a;TransitionScreen(!0,score)}}
function isPaused(){for(var a=0;a<MODAL_IDS.length;a++)if($(MODAL_IDS[a]).hasClass("in"))return!0;return!$("#play").hasClass("active")}function scoreFunc(a){return 100*a.length+0}
function generateShareUrl(){button=$("#share");linkArea=$("#linkArea");facebook=$("#post-to-facebook");button.addClass("hidden-button");button.removeClass("shown-button");linkArea.addClass("shown-button");linkArea.removeClass("hidden-button");USER_DATA.is_facebook_user&&(facebook.addClass("shown-button"),facebook.removeClass("hidden-button"))}
function createStaticGameIfApplicable(){for(var a=[],b,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++)b=c[d].split("="),a.push(b[0]),a[b[0]]=b[1];a.id&&(messenger.getStaticWords(initializeBoard,a.id),returnToGame())};(function(a){a.fn.formset=function(b){var c=a.extend({},a.fn.formset.defaults,b),d=c.extraClasses.join(" "),b=a(this),g=function(a,b){c.extraClasses&&(a.removeClass(d),a.addClass(c.extraClasses[b%c.extraClasses.length]))},e=function(a,b,c){var e=RegExp("("+b+"-\\d+-)|(^)"),b=b+"-"+c+"-";a.attr("for")&&a.attr("for",a.attr("for").replace(e,b));a.attr("id")&&a.attr("id",a.attr("id").replace(e,b));a.attr("name")&&a.attr("name",a.attr("name").replace(e,b))},f=function(b){b.is("TR")?b.children(":last").append('<a class="'+
c.deleteCssClass+'" href="javascript:void(0)">'+c.deleteText+"</a>"):b.is("UL")||b.is("OL")?b.append('<li><a class="'+c.deleteCssClass+'" href="javascript:void(0)">'+c.deleteText+"</a></li>"):b.append('<a class="'+c.deleteCssClass+'" href="javascript:void(0)">'+c.deleteText+"</a>");b.find("a."+c.deleteCssClass).click(function(){var b=a(this).parents("."+c.formCssClass),f=b.find('input:hidden[id $= "-DELETE"]');if(f.length)f.val("on"),b.hide();else{b.remove();f=a("."+c.formCssClass).not(".formset-custom-template");
a("#id_"+c.prefix+"-TOTAL_FORMS").val(f.length);for(var d=0,j=f.length;d<j;d++)g(f.eq(d),d),f.eq(d).find("input,select,textarea,label").each(function(){e(a(this),c.prefix,d)})}c.removed&&c.removed(b);return!1})};b.each(function(b){var e=a(this),d=e.find('input:checkbox[id $= "-DELETE"]');d.length&&(d.before('<input type="hidden" name="'+d.attr("name")+'" id="'+d.attr("id")+'" />'),d.remove());0<e.find("input,select,textarea,label").length&&(f(e),e.addClass(c.formCssClass),g(e,b))});if(b.length){var j;
c.formTemplate?(j=c.formTemplate instanceof a?c.formTemplate:a(c.formTemplate),j.removeAttr("id").addClass(c.formCssClass).addClass("formset-custom-template"),j.find("input,select,textarea,label").each(function(){e(a(this),c.prefix,2012)}),f(j)):(j=a("."+c.formCssClass+":last").clone(!0).removeAttr("id"),j.find('input:hidden[id $= "-DELETE"]').remove(),j.find("input,select,textarea,label").each(function(){var b=a(this);b.is("input:checkbox")||b.is("input:radio")?b.attr("checked",!1):b.val("")}));
c.formTemplate=j;"TR"==b.attr("tagName")?(j=b.eq(0).children().length,b.parent().append('<tr><td colspan="'+j+'"><a class="'+c.addCssClass+'" href="javascript:void(0)">'+c.addText+"</a></tr>"),j=b.parent().find("tr:last a"),j.parents("tr").addClass(c.formCssClass+"-add")):(b.filter(":last").after('<a class="'+c.addCssClass+'" href="javascript:void(0)">'+c.addText+"</a>"),j=b.filter(":last").next());j.click(function(){var b=parseInt(a("#id_"+c.prefix+"-TOTAL_FORMS").val()),d=c.formTemplate.clone(!0).removeClass("formset-custom-template"),
f=a(this).parents("tr."+c.formCssClass+"-add").get(0)||this;g(d,b);d.insertBefore(a(f)).show();d.find("input,select,textarea,label").each(function(){e(a(this),c.prefix,b)});a("#id_"+c.prefix+"-TOTAL_FORMS").val(b+1);c.added&&c.added(d);return!1})}return b};a.fn.formset.defaults={prefix:"form",formTemplate:null,addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],added:null,removed:null}})(jQuery);(function(a,b,c){function d(a){return a}function g(a){return decodeURIComponent(a.replace(e," "))}var e=/\+/g,f=a.cookie=function(e,h,i){if(h!==c){i=a.extend({},f.defaults,i);null===h&&(i.expires=-1);if("number"===typeof i.expires){var k=i.expires,l=i.expires=new Date;l.setDate(l.getDate()+k)}h=f.json?JSON.stringify(h):String(h);return b.cookie=[encodeURIComponent(e),"=",f.raw?h:encodeURIComponent(h),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+
i.domain:"",i.secure?"; secure":""].join("")}h=f.raw?d:g;i=b.cookie.split("; ");k=0;for(l=i.length;k<l;k++){var m=i[k].split("=");if(h(m.shift())===e)return e=h(m.join("=")),f.json?JSON.parse(e):e}return null};f.defaults={};a.removeCookie=function(b,c){return null!==a.cookie(b)?(a.cookie(b,null,c),!0):!1}})(jQuery,document);function getLeaderboard(a){messenger.getLeaderboard(a)}function getUserRank(){messenger.getUserRank()}function insertLeaderboardData(a){$("#leaderboard_table").html("");for(var b=0;b<a.length;b++){var c=a[b],d=$("<tr>");d.append($("<td>").text(c.rank));d.append($("<td>").text(c.user));d.append($("<td>").text(c.score));$("#leaderboard_table").append(d)}}
function insertUserRank(a){if(null!==a){var b=$("#user_rank");b.html("");var c=$("<p>").text("Your Rank: "+a.rank).css({"float":"left"}),a=$("<p>").text("Your High Score: "+a.score).css({"float":"right"});b.append(c).append(a);b.insertBefore($("#leaderboard_table"))}};function initializeMenuButtons(){$("#play.carousel").carousel({interval:!1});$("#game-help").popover();$("#game-options .accordion-body").on("shown",function(){$(this).siblings(".accordion-heading").children(".accordion-toggle").css({opacity:"1"})});$("#game-options .accordion-body").on("hidden",function(){$(this).siblings(".accordion-heading").children(".accordion-toggle").css({opacity:".4"})});initializeDifficultyButtons();$("#start-button").click(function(){startGame();returnToGame()});$("#return-button").click(returnToGame);
$("#new-game").click(returnToStart);$("#quit-game").click(quitGame);$("#restart").click(restart);$("#share").click(generateShareUrl);$("#transition-screen").click(transitionClick);$("#post-to-facebook").click(postToFacebook);$("#game-area").tooltip({selector:'[rel="tooltip"]'})}
function initializeDifficultyButtons(){$("#step-less-exp").click(function(){isPrevStepLess||(expDifficultyStep=INCR_DIFFICULTY);isPrevStepLess=!0;expDifficultyStep<MAX_DIFFICULTY&&(expDifficultyStep*=2);incrementDifficulty(-expDifficultyStep)});$("#step-less-const").click(function(){incrementDifficulty(-INCR_DIFFICULTY)});$("#step-more-const").click(function(){incrementDifficulty(INCR_DIFFICULTY)});$("#step-more-exp").click(function(){isPrevStepLess&&(expDifficultyStep=INCR_DIFFICULTY);isPrevStepLess=
!1;expDifficultyStep<MAX_DIFFICULTY&&(expDifficultyStep*=2);incrementDifficulty(expDifficultyStep)});$("#toggle-difficulty").click(function(){$(this).is(":checked")?$("#setting-difficulty").css("background-color","white"):$("#setting-difficulty").css("background-color","#ddd")})}
function incrementDifficulty(a){var b=parseInt($("#setting-difficulty").val()),b=Math.max(0,Math.min(MAX_DIFFICULTY,b+a));$("#setting-difficulty").val(b);a=50>b?"Easy":50<=b&&100>b?"Medium":"Hard";$("#difficulty-text").text(a)}function returnToGame(){$("#play.carousel").carousel("next");$("#start-menu").hide();inStartMenu=!1}function returnToStart(){null!=board&&$("#start-game-inprogress").show();$("#start-menu").show();$("#play.carousel").carousel("prev");inStartMenu=!0}
function startGame(){gameIsStarted&&resetEvents();gameIsStarted=!0;$("#drag-blocker").css({"z-index":"-1"});var a=$("#game-options .accordion-body.in");if(0==a.size())messenger.getWords(initializeBoard,null,null);else if("dict-game"==a[0].id){a=parseInt($("#setting-difficulty").val());$("#toggle-difficulty").is(":checked")||(a=null);var b=parseInt($("#setting-tag").val());isNaN(b)&&(b=null);messenger.getWords(initializeBoard,a,b)}else custom_list=$("#setting-custom").val(),messenger.getCustomWords(initializeBoard,
custom_list);showGameButtons()}function quitGame(){for(var a=window.board.definitions.getDefinitions(),b=0;b<a.length;b++)for(var c=0;c<a[b].length;c++)window.board.definitions.displayHint(b);$("#score-breakdown").hide();TransitionScreen(!1,0)}function restart(){resetEvents();startGame()}function resetEvents(){$(document).off("keydown");$(document).off("shown");$(document).off("hidden");$(document).off("keypress")}
function showGameButtons(){$("#new-game").removeClass("hidden-button");$("#new-game").addClass("shown-button");$("#quit-game").removeClass("hidden-button");$("#quit-game").addClass("shown-button");$("#restart").removeClass("shown-button");$("#restart").addClass("hidden-button");$("#share").removeClass("shown-button");$("#share").addClass("hidden-button");$("#share").html("Share");$("#linkArea").removeClass("shown-button");$("#linkArea").addClass("hidden-button");$("#post-to-facebook").removeClass("shown-button");
$("#post-to-facebook").addClass("hidden-button")}function showGameOverButtons(){$("#new-game").removeClass("hidden-button");$("#new-game").addClass("shown-button");$("#quit-game").removeClass("shown-button");$("#quit-game").addClass("hidden-button");$("#restart").removeClass("hidden-button");$("#restart").addClass("shown-button")}function transitionClick(){$("#transition-screen").css({"z-index":"-1"})}
function postToFacebook(){$("#id_link").val($("#linkArea").text());$("#fb_description").val("I just got a score of "+$("#score-final").text()+" on Tile To The Top!  Can you beat my score?");$("#fb_description").attr("readonly","readonly");$("#fb_message").val("");$("#facebook-modal").modal("show")};var Messenger=function(){var a=window.location.host,b=-1!=a.indexOf("localhost")||-1!=a.indexOf("127.0.0.1");this.getWords=function(a,d,g){var e={word_count:NUM_WORDS,max_wordlen:MAX_WORDLEN};null!=d&&(e.difficulty=d);null!=g&&(e.tag_filter=g);$.ajax({url:"/random-words/",type:"GET",dataType:"json",data:e,success:function(b){a(b)},error:function(){b&&alert("getWords ajax error")}})};this.getStaticWords=function(a,d){$.ajax({url:"/static-words/",type:"GET",dataType:"json",data:{id:d},success:function(b){a(b)},
error:function(){b&&alert("static words error")}})};this.getCustomWords=function(a,d){$.ajax({url:"/custom-words/",type:"GET",dataType:"json",data:{id:d,num_words:4},success:function(b){a(b)},error:function(){b&&alert("custom words error")}})};this.getCustomListForms=function(a,d){$.ajax({url:"/edit-customlist/",type:"GET",dataType:"html",data:{custom_list_id:d},success:function(b){a(b)},error:function(){b&&alert("getCustomListForms ajax error")}})};this.pushGameData=function(a,d,g,e,f){$.ajax({url:"/push-game-data/",
type:"POST",dataType:"json",data:{score:a,definitions:d,words:g,mode:e},headers:{"X-CSRFToken":$.cookie("csrftoken")},success:f,error:function(){b&&alert("pushGameData ajax error")}})};this.getUserData=function(){$.ajax({url:"/get-user-data/",type:"GET",dataType:"json",success:function(a){insertAccountData(a)},error:function(){}})};this.getLeaderboard=function(a){$.ajax({url:"/get-leaderboard/",type:"GET",dataType:"json",data:{count:a},success:function(a){insertLeaderboardData(a)},error:function(){b&&
alert("getLeaderboard ajax error")}})};this.getUserRank=function(){$.ajax({url:"/get-user-rank/",type:"GET",dataType:"json",success:function(a){insertUserRank(a)},error:function(){b&&alert("getUserRank ajax error")}})};this.postToFacebook=function(a,b,g){data={message:b,link:a,description:g};$.ajax({url:"/post-to-facebook/",type:"POST",dataType:"json",data:data,headers:{"X-CSRFToken":$.cookie("csrftoken")},success:function(){},error:function(){}})}};$(function(){0<$("#register-modal").find(".help-inline").length||0<$("#register-modal").find(".alert").length?$("#register-modal").modal("show"):(0<$("#login-modal").find(".help-inline").length||0<$("#login-modal").find(".alert").length)&&$("#login-modal").modal("show");$("#facebook-submit").click(function(){var a="I just got a score of "+$("#score-final").text()+" on Tile To The Top! Can you beat my score?";link=$("#id_link").val();message=$("#fb_message").val();messenger.postToFacebook(link,message,
a)});if("#_=_"==window.location.hash||"#"==window.location.hash)window.location.hash="";"#register-modal"==window.location.hash&&($("#register-modal").modal("show"),window.location.hash="");"#login-modal"==window.location.hash&&($("#login-modal").modal("show"),window.location.hash="");"#wordlists"==window.location.hash&&($('a[href="#wordlists"]').tab("show"),window.location.hash="")});(function(a){a.fn.textfill=function(b){var b=b.maxFontPixels,c=a("span:visible:first",this),d=a(this).height(),g=a(this).width(),e,f,j=a(c[0]).text(),h=a(c[0]);a.each(c,function(b){a(c[b]).text().length>j.length&&(j=a(c[b]).text(),h=a(c[b]))});do h.css("font-size",b),e=h.height(),f=h.width(),b-=1;while((e>d||f>g)&&3<b);c.css("font-size",b);return this}})(jQuery);var TileArea=function(a){var b=$("<div>").attr("id","tiles-area");$("#game-area").append(b);var c=b.width();b.offset();var d=parseInt(c/(TILE_SIZE+10));this.shuffle(a);for(var c=Math.max(2,Math.ceil(a.length/d)),g,e=0;e<c*d;e++){var f=parseInt(e/d),j=e%d;0==j&&(g=$("<div>").addClass("tile-row"),b.append(g));var h=$("<div>");h.attr("id","tileBox"+f+"_"+j);h.addClass("tile-box");h.attr({ondrop:"dropTileInTileArea(event)",ondragover:"dragTileOverTileArea(event)",ondragleave:"leaveTileArea(event)"});
g.append(h)}$.each(a,function(b){var c=$("<div>");c.addClass("tile");c.addClass("inTileArea");c.html("<p>"+a[b].toUpperCase()+"</p>");c.attr("id","tile"+b);c.attr("draggable","true");c.attr("ondragstart","dragTile(event)");b="#tileBox"+parseInt(b/d)+"_"+b%d;$(b).append(c);$(b).height();$(b).width();c.centerOnParent();$.browser.msie&&9<=parseInt($.browser.version,10)&&(c=document.getElementById(c.attr("id")),c.dragDrop&&$(c).bind("mousemove",handleDragMouseMove))})};
TileArea.prototype.shuffle=function(a){var b=a.length;if(0==b)return!1;for(;--b;){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c];a[c]=d}};function getTileFromChar(a){for(var b=$(".inTileArea"),c=0;c<b.length;c++)if($(b[c]).text()==a)return $(b[c]);return!1}function addToTileArea(a){for(var b=$(".tile-box"),c=0;c<b.length;++c){var d=$(b.get(c));if(0==d.children().length){d.append(a);break}}$(a).addClass("inTileArea");$(a).centerOnParent()};var Timer=function(){var a,b=0,c=0;this.pause=function(){clearInterval(a)};this.getSec=function(){return b};this.getMin=function(){return c};this.resume=function(){this.setStartTime();a=setInterval(function(){!isPaused()&&!inStartMenu&&(b+=1,60<=b&&(c+=b/60,b%=60),$("#min").html(""+(10>c?"0"+c:""+c)),$("#sec").html(""+(10>b?"0"+b:""+b)))},1E3)};this.setStartTime=function(){var a=$("#timer-display").text().split(":");b=parseInt(a[1]);c=parseInt(a[0])};$("#min").html("00");$("#sec").html("00");this.resume()};function TransitionScreen(a,b){if(a){var c=window.board.definitions.getDefinitions(),d=window.board.workspace.getSolutions();messenger.pushGameData(b,c,d,window.board.mode,processPushedGame)}timer.pause();$("#drag-blocker").css({"z-index":"100"});resetEvents();var g=$(".clicked");$.each(g,function(){g.toggleClass("clicked")});$("#transition-message").text(a?"Congratulations, you won!":"Game over");$("#score-final").text(b);$("#transition-screen").css({"z-index":"100"});setTimeout(messenger.getUserData,
2E3);setTimeout(messenger.getLeaderboard,2E3);setTimeout(messenger.getUserRank,2E3);showGameOverButtons()}function processPushedGame(a){a&&($("#share").removeClass("hidden-button"),$("#share").addClass("shown-button"),a=window.location.origin+"/?id="+a.id,$("#linkArea").text(a))};jQuery.fn.extend({disableSelection:function(){return this.each(function(){this.onselectstart=function(){return!1};this.unselectable="on";jQuery(this).css("user-select","none");jQuery(this).css("-o-user-select","none");jQuery(this).css("-moz-user-select","none");jQuery(this).css("-khtml-user-select","none");jQuery(this).css("-webkit-user-select","none")})}});
jQuery.fn.extend({centerOnParent:function(){var a=this.parent().offset(),b=this.parent().css("border-left-width"),b=parseInt(b,10);isNaN(b)&&(b=0);var c=(this.parent().height()-this.height())/2,d=(this.parent().width()-this.width())/2;this.offset({top:c+a.top+b,left:d+a.left+b})}});function initializeWordListButtons(){initializeFormset();$("#new-list").click(createList);$("#edit-list").click(editList);$("#save-list").click(saveList);$("#delete-list").click(deleteList)}function initializeFormset(){$("#list-entries tr").formset({prefix:"cw",addText:"+ Add row",deleteText:"x"})}function createList(){messenger.getCustomListForms(displayForms,-1);$("#delete-list").attr("disabled","disabled");$("#new-list").button("loading")}
function editList(){var a=parseInt($("#existing-list-name").val());a&&(messenger.getCustomListForms(displayForms,a),$("#delete-list").removeAttr("disabled"),$("#edit-list").button("loading"))}function displayForms(a){a=$("#custom-form-content",a).html();$("#custom-form-content").html(a);initializeFormset();$("#new-list").button("reset");$("#edit-list").button("reset")}
function getErrorAlert(a){var a=$("<div>").attr("class","alert alert-error").text(a),b=$("<a>").attr({"class":"close","data-dismiss":"alert"}).text("x");a.append(b);a.alert();return a}
function saveList(){$("#custom-words .alert").alert("close");var a=/^[a-zA-Z 0-9]*$/,b=$("#list-entries").children("tr"),c=!0,d=0,g=[],e=$("#div_id_name");0==e.children().children("#id_name").val().trim().length?(c=!1,e.addClass("error")):e.removeClass("error");c||$("#customlist-form").after(getErrorAlert("Enter a list name."));for(e=0;e<b.length;e++)if($(b[e]).is(":visible")){var f=$(b[e]).children("td"),j=$(f[0]).children(),h=j.children().children().val().trim(),f=$(f[1]).children(),i=f.children().children().val().trim();
!a.test(h)||10<h.length||0==h.length&&0!=i.length?(c=!1,j.addClass("error")):j.removeClass("error");0==i.length&&0!=h.length?(c=!1,f.addClass("error")):f.removeClass("error");0!=h.length&&0!=i.length?d++:g.length<NUM_WORDS&&(0==h.length&&0==i.length)&&g.push([j,f])}for(e=0;e<g.length;e++)e<NUM_WORDS-d?$.each(g[e],function(a,b){b.addClass("error")}):$.each(g[e],function(a,b){b.removeClass("error")});c&&d>=NUM_WORDS&&($("#custom-form").attr("action","/save-customlist/"),$("#custom-form").submit(),$("#save-list").button("loading"));
c||$("#customwords-formset").after(getErrorAlert("Each word must be paired with a definition."));d<NUM_WORDS&&$("#customwords-formset").after(getErrorAlert("Enter at least 4 words."))}function deleteList(){$("#custom-form").attr("action","/delete-customlist/");$("#custom-form").submit();$("#delete-list").button("loading")};var Workspace=function(a){var b=this,c=function(){var a=!$(this).hasClass("clicked"),b=$(".clicked");$.each(b,function(){b.toggleClass("clicked")});$(this).toggleClass("clicked",a)},d=function(a){if(a.target==this){for(var a=$(this).children(),b=0;b<a.length;b++)if($(a[b]).hasClass("clicked"))return $(a[b]).triggerHandler("click"),!1;a=getNextEmpty($(a[0]).attr("id"));$(a).triggerHandler("click")}},g=$("<div>").addClass("right-col");$("#definitions-answers-area").append(g);$.each(a,function(b){var f=
$("<div>");f.addClass("answer");f.attr("id","answer_"+b);f.bind("click",d);g.append(f);for(var j=a[b],h=0;h<j.length;h++){var i=$("<div>");i.addClass("emptyTileLoc");i.attr({id:"emptyTile_"+b+"_"+h,ondrop:"dropTileInEmptyTile(event)",ondragover:"dragTileOverEmptyTile(event)",ondragleave:"leaveEmptyTile(event)"});f.append(i);i.bind("click",c);var k=f.offset(),l=h*(i.width()+10),m=(f.height()-i.height())/2;i.offset({top:k.top+m,left:k.left+10+l})}});this.winCheck=function(){var b=g.children(),c=!0;
for(index=0;index<b.length;index++)for(var d=$(b[index]).children(),h=0;h<d.length;h++){var i=$(d[h]),i=$($(i.children()[0]).html()).text().toLowerCase(),k=a[index][h].toLowerCase();i!=k&&(c=!1)}return c};$(document).on("keydown",function(a){if("HTML"!=document.activeElement.tagName.toUpperCase()){var c=a.keyCode;32==c&&a.preventDefault();if(!isPaused()){if(65<=c&&90>=c||32==c||57>=c&&48<=c)if(a=$(".clicked"),1==a.length){var d=getTileFromChar(String.fromCharCode(c).toUpperCase());if(d&&0==a.children().length&&
($(d).appendTo($(a[0])),$(d).removeClass("inTileArea"),$(d).centerOnParent(),checkGameWon(),d=getNextEmpty($(a[0]).attr("id"))))$(a[0]).removeClass("clicked"),$(d).addClass("clicked")}192==c&&ANSWER_CHEAT_ON&&alert(b.getSolutions())}}});$(document).on("keydown",function(a){var b=a.keyCode;0==b&&(b=a.which);9==b&&a.preventDefault();if("HTML"!=document.activeElement.tagName.toUpperCase()){if(8==b&&!isPaused())return a.preventDefault(),a=$(".clicked"),1==a.length&&deleteBoxAt($(a[0]).attr("id")),!1;
if((37==b||39==b)&&!isPaused())if(a=$(".clicked"),1==a.length){var c;if(c=37==b?getBoxAtOffset($(a[0]).attr("id"),-1):getBoxAtOffset($(a[0]).attr("id"),1))$(a[0]).removeClass("clicked"),$(c).addClass("clicked")}if((38==b||40==b||9==b)&&!isPaused())if(a=$(".clicked"),1==a.length){c=$(a).attr("id");var d=parseInt(c.split("_")[1]);parseInt(c.split("_")[2]);b=38==b?$("#emptyTile_"+(d-1)+"_0"):40==b?$("#emptyTile_"+(d+1)+"_0"):$("#emptyTile_"+(d+1)%NUM_WORDS+"_0");0!=b.length&&((c=getNextEmpty($(b).attr("id")))||
(c=getLastInRow($(b).attr("id"))),$(a[0]).removeClass("clicked"),$(c).addClass("clicked"))}}});this.getSolutions=function(){return a}};function getNextEmpty(a){for(var b=parseInt(a.split("_")[1]),a=parseInt(a.split("_")[2]);;){var c=$("#emptyTile_"+b+"_"+a);if(1==c.length&&0==c.children().length)return $(c[0]);if(0==c.length)return!1;a+=1}}
function getBoxAtOffset(a,b){if(0==b)return $("#"+a);for(var c=parseInt(a.split("_")[1]),d=parseInt(a.split("_")[2]),g=d,e=null;;){var f=$("#emptyTile_"+c+"_"+g);if(0==f.length)return null==e?!1:e;if(g==d+b)return $(f[0]);1==f.length&&(e=f[0]);0>b?g-=1:0<b&&(g+=1)}}function getLastInRow(a){for(var b=parseInt(a.split("_")[1]),c=parseInt(a.split("_")[2]),d=$("#"+a),a=$("#"+a);;){c+=1;a=$("#emptyTile_"+b+"_"+c);if(0==a.length)break;d=a[0]}return d}
function deleteBoxAt(a){var b=$("#"+a),c=b.children().length,d=!1;0==c&&(b=getBoxAtOffset(a,-1),d=!0,c=b.children().length);1==c&&(a=b.children()[0],addToTileArea(a));if(d&&(d=$(".clicked")[0],a=getBoxAtOffset($(d).attr("id"),-1)))$(d).removeClass("clicked"),$(a).addClass("clicked")};
